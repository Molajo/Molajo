/*
* Kendo UI v2011.3.1129 (http://kendoui.com)
* Copyright 2011 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at http://kendoui.com/license.
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3. For GPL requirements, please
* review: http://www.gnu.org/copyleft/gpl.html
*/

(function(a,b){function q(b){var c={},d,e,f,g,h,i,j,k,l;for(d=0,e=b.length;d<e;d++){g=b[d].name.split(/[\.\[\]]+/),g=a.grep(g,function(a){return a}),i=b[d].value,j=c,l=c;for(h=0;h<g.length-1;h++)f=g[h],isNaN(f)||(k=g[h-1],a.isArray(l[k])||(j=l[k]=[])),l=j,j=j[f]=j[f]||{};j[g[h]]=i}return c}function p(a,b){var c=a.data(e)||a.data(f)||a.data(g);c?c.value(b):a.is(":radio")?a.filter("[value="+b+"]").attr("checked","checked"):a.val(b)}function o(b,c){b.filters&&(b.filters=a.grep(b.filters,function(a){o(a,c);return a.field!=c}))}var c=window.kendo,d=c.ui,e="kendoDropDownList",f="kendoNumericTextBox",g="kendoDatePicker",h=a.proxy,i="kendoPopup",j="Is equal to",k="Is not equal to",l=d.Widget,m='<div><input type="hidden" name="filters[0].field" value="#=field#"/><input type="hidden" name="filters[0].operator" value="eq"/><div class="k-filter-help-text">#=messages.info#</div><label>#=messages.isTrue#<input type="radio" name="filters[0].value" value="true"/></label><label>#=messages.isFalse#<input type="radio" name="filters[0].value" value="false"/></label><button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',n='<div><input type="hidden" name="filters[0].field" value="#=field#"/><input type="hidden" name="filters[1].field" value="#=field#"/><div class="k-filter-help-text">#=messages.info#</div><select name="filters[0].operator">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select><input name="filters[0].value" class="k-widget k-input k-autocomplete" type="text" data-#=ns#type="#=type#"/>#if(extra){#<select name="logic" class="k-filter-and"><option value="and">And</option><option value="or">Or</option></select><select name="filters[1].operator">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select><input name="filters[1].value" class="k-widget k-input k-autocomplete" type="text" data-#=ns#type="#=type#"/>#}#<button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',r=l.extend({init:function(b,d){var j=this,k="string",o,p,q,r;l.fn.init.call(j,b,d),r=d.operators||{},b=j.element,d=j.options,o=b.addClass("k-filterable").find("k-grid-filter"),o[0]||(o=b.prepend('<a class="k-grid-filter" href="#"><span class="k-icon k-filter"/></a>').find(".k-grid-filter")),o.click(h(j._click,j)),j.dataSource=d.dataSource.bind("change",h(j.refresh,j)),j.field=b.attr(c.attr("field")),j.model=j.dataSource.reader.model,j._parse=function(a){return a+""},j.model&&j.model.fields&&(p=j.model.fields[j.field],p&&(k=p.type,j._parse=h(p.parse,p))),r=r[k]||d.operators[k],j.form=a('<form class="k-filter-menu k-group"/>'),j.form.html(c.template(k==="boolean"?m:n)({field:j.field,ns:c.ns,messages:d.messages,extra:d.extra,operators:r,type:k})),j.popup=j.form[i]({anchor:o,open:h(j._open,j)}).data(i),j.link=o,j.form.bind({submit:h(j._submit,j),reset:h(j._reset,j)}).find("select")[e]().end().find("["+c.attr("type")+"=number]")[f]().end().find("["+c.attr("type")+"=date]")[g](),j.refresh()},refresh:function(){var a=this,b=a.form,c=a.dataSource.filter()||{filters:[],logic:"and"},d=c.filters,e,f,g,h=0;for(f=0,g=d.length;f<g;f++)e=d[f],e.field==a.field&&(p(b.find("[name='filters["+h+"].value']"),a._parse(e.value)),p(b.find("[name='filters["+h+"].operator']"),e.operator),h++);h>0?(p(b.find("[name=logic]"),c.logic),a.link.addClass("k-state-active")):a.link.removeClass("k-state-active")},_merge:function(b){var c=this,d=b.logic||"and",e=b.filters,f,g=c.dataSource.filter()||{filters:[],logic:"and"},h,i;o(g,c.field),e=a.grep(e,function(a){return a.value!=""});for(h=0,i=e.length;h<i;h++)f=e[h],f.value=c._parse(f.value);e.length&&(g.filters.length?(b.filters=e,g.logic!=="and"&&(g.filters=[{logic:g.logic,filters:g.filters}],g.logic="and"),e.length>1?g.filters.push(b):g.filters.push(e[0])):(g.filters=e,g.logic=d));return g},filter:function(a){a=this._merge(a),a.filters.length&&this.dataSource.filter(a)},clear:function(){var b=this,c=b.dataSource.filter()||{filters:[]};c.filters=a.grep(c.filters,function(a){return a.field!=b.field}),c.filters.length||(c=null),b.dataSource.filter(c)},_submit:function(a){var b=this;a.preventDefault(),b.filter(q(b.form.serializeArray())),b.popup.close()},_reset:function(a){this.clear(),this.popup.close()},_click:function(a){a.preventDefault(),a.stopPropagation(),this.popup.toggle()},_open:function(){a(".k-filter-menu").not(this.form).each(function(){a(this).data(i).close()})},options:{name:"FilterMenu",extra:!0,type:"string",operators:{string:{eq:j,neq:k,startswith:"Starts with",contains:"Contains",endswith:"Ends with"},number:{eq:j,neq:k,gte:"Is greater than or equal to",gt:"Is greater than",lte:"Is less than or equal to",lt:"Is less than"},date:{eq:j,neq:k,gte:"Is after or equal to",gt:"Is after",lte:"Is before or equal to",lt:"Is before"}},messages:{info:"Show rows with value that:",isTrue:"is true",isFalse:"is false",filter:"Filter",clear:"Clear"}}});d.plugin(r)})(jQuery)